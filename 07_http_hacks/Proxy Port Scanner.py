1 #!/usr/bin/python 2 3 import sys 4 from socket import socket, AF_INET, SOCK_STREAM 5 6 7 if len(sys.argv) < 4: 8 print sys.argv[0] + ": <proxy> <port> <target>" 9 sys.exit(1) 10 11 # For every interesting port 12 for port in (21, 22, 23, 25, 80, 443, 8080, 3128): 13 14 # Open a TCP socket to the proxy 15 sock = socket(AF_INET, SOCK_STREAM) 16 sock.connect((sys.argv[1], int(sys.argv[2]))) 17 18 # Try to connect to the target and the interesting port 19 sock.send("CONNECT " + sys.argv[3] + ":" + str(port) + \ 20 " HTTP/1.1\r\n\r\n") 21 resp = sock.recv(1024) 22 23 # Parse status code from http response line 24 try: 25 status = int(resp.split(" ")[1]) 26 except (IndexError, ValueError): 27 status = None 28 29 # Everything ok? 30 if status == 200: 31 sock.send("GET / HTTP/1.0\r\n\r\n") 32 resp = sock.recv(1024) 33 print "Port " + str(port) + " is open" 34 print resp 35 36 # Got error 37 elif status >= 400 and status < 500: 38 print "Bad proxy! Scanning denied." 39 break 40 elif status >= 500: 41 print "Port " + str(port) + " is closed" 42 else: 43 print "Unknown error! Got " + resp 44 45 sock.close()